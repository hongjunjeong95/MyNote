# 개발 프로그램 및 설정

## 기본 설치 프로그램

참조 링크

https://subicura.com/mac/dev/intel.html#command-line-tools

# 개발자 필수 프로그램

### homebrew

homebrew는 각종 커맨드라인 프로그램과 일반 프로그램(크롬..)을 손쉽게 설치해주는 맥용 패키지 매니저입니다.(최근에 리눅스도 지원하기 시작했습니다.) 리눅스의 `apt`나 `yum`과 비슷하며 brew 외에 [MacPorts](https://www.macports.org/) 라는 패키지 메니저가 있는데 몇몇 단점으로 요즘은 거의 brew를 사용하는 추세입니다. 다양한 프로그램을 복잡한 빌드과정 없이 손쉽게 설치할 수 있고 업데이트, 관리도 간단하므로 안쓸 이유가 없는 필수 프로그램입니다. `그냥 홈페이지 가서 다운로드 하고 설치하는 게 편한데..`라고 하는분들이 있는데 나중에 업데이트나 삭제를 생각해보면 글쎄요.. brew 쓰세요!

**설치**

```bash
/bin/bash -c "$(curl -fsSL <https://raw.githubusercontent.com/Homebrew/install/master/install.sh>)"
```

**확인**

```bash
*# brew test*
$ brew doctor
Your system is ready to brew.
```

만약 `zsh: command not found: brew`가 떴을 경우

```bash
$ eval "$(/opt/homebrew/bin/brew shellenv)"
```

위 명령어 후에 다시 `brew doctor` 을 한다.

[Homebrew 홈페이지](https://brew.sh/) / [brew 명령어](https://docs.brew.sh/Manpage.html) / [brew 패키지 검색](http://formulae.brew.sh/)

### git

버전 관리 도구로 유명한 `git`입니다. 다들 아시죠? macOS에 기본으로 설치되어 있지만 최신 버전이 아니므로 `brew`를 이용해서 업데이트 합니다. `git-lfs` 는 Git Large File Storage로 용량이 큰 바이너리 파일을 git으로 관리할 때 유용합니다. git 설치할 때 같이 설치합니다.

**설치**

```bash
brew install git git-lfs
```

git 설치가 완료되었으면 개인정보를 설정하고 맥에서 한글 파일명을 정상적으로 처리하기 위해 추가 옵션을 설정합니다. 망할 한글처리

**설정**

```bash
git config --global user.name "Your Name"
git config --global user.email "you@your-domain.com"
git config --global core.precomposeunicode true
git config --global core.quotepath false
```

[Git 홈페이지](https://git-scm.com/) / [Git LFS 홈페이지](https://git-lfs.github.com/)

### Authy

```bash
brew install --cask authy
```

MFA 인증을 도와주는 무료 프로그램이다.

### VSC

```bash
brew install --cask visual-studio-code
```

편리한 Text Editor다.

- 추천 Extensions

  - docker
  - HashiCorp Terraform
  - prettier
  - markdown all in one
  - material icon theme
  - material theme
  - bracket pair colorizer
  - indent-rainbow
  - auto rename tag
  - css peek
  - html css support

  ```json
  // settings.json on vsc
  
  {
    "workbench.colorTheme": "Material Theme Darker High Contrast",
    "editor.inlineSuggest.enabled": true,
    "material-icon-theme.activeIconPack": "nest",
    "editor.formatOnSave": true,
    "workbench.iconTheme": "material-icon-theme",
    "explorer.confirmDragAndDrop": false,
    "explorer.confirmDelete": false,
    "typescript.updateImportsOnFileMove.enabled": "always",
    "javascript.updateImportsOnFileMove.enabled": "always",
    "python.formatting.provider": "black",
    "explorer.compactFolders": false,
    "editor.tokenColorCustomizations": {
      "comments": "#ffc2c2"
    },
    "[python]": {
      "editor.formatOnType": true
    },
    "[typescript]": {
      "editor.defaultFormatter": "esbenp.prettier-vscode"
    },
    "[typescriptreact]": {
      "editor.defaultFormatter": "esbenp.prettier-vscode"
    },
    "[terraform]": {
      "editor.defaultFormatter": "hashicorp.terraform",
      "editor.formatOnSave": true,
      "editor.formatOnSaveMode": "file"
    },
    "debug.javascript.autoAttachFilter": "disabled",
    "security.workspace.trust.untrustedFiles": "open",
    "redhat.telemetry.enabled": true,
    "window.zoomLevel": 1,
    "scm.showChangesSummary": false,
    "scm.showIncomingChanges": "never",
    "scm.showOutgoingChanges": "never",
    "editor.defaultFormatter": "esbenp.prettier-vscode",
    "prisma.showPrismaDataPlatformNotification": false
  }
  ```

### Intellij

```bash
brew install --cask intellij-idea
```

Java or Kotlin 개발에 필요한 IDE다.

무료 Community 버전도 있지만 회사에서 유료 버전을 지원해주기 때문에 유료버전을 설치하고 라이센스 키를 등록하자. 라이센스 키는 개발팀장에게 요청하여 회사 이메일로 등록하면 되고 intellij에 gmail로 로그인 한 후 Activate Licence key를 하면 된다.

### Docker

```bash
brew install --cask docker
```

### Dbeaver

RDB UI 툴이다.

Dbeaver 같은 경우 brew로 설치가 안 되기 때문에

https://dbeaver.io/download/

해당 사이트에 가서 직접 운영체제에 맞는 프로그램을 설치하길 바란다.

### RDB 관련 추가 필요한 cli 설치

버터플라잉은 postgresql을 사용한다. 앞으로 db dump나 cli를 통한 디비 접근이 필요할 때가 있다.

1. psql 설치

```bash
brew install libpq
```

1. 설치된 `libpq` 의 경로를 사용하는 쉘 환경파일의 PATH 로 추가해줍니다.

✔️ zsh

```bash
echo 'export PATH="/opt/homebrew/opt/libpq/bin:$PATH"' >> ~/.zshrc
```

1. 쉘 환경파일의 변경사항을 적용한다.

✔️ zsh

```bash
source ~/.zshrc
```

1. psql 설치 확인

```bash
psql --version
```

이제 로컬 환경에 직접 RDB 를 설치할 필요없이 `psql` 이나 `pg_dump` 와 같은 인터페이스를 사용할 수 있다.

### Mongo Compass

```bash
brew install --cask mongodb-compass
```

mongo DB를 볼 수 있는 UI

### Mongo 관련 추가 필요한 cli 설치

몽고도 dump를 뜨거나 cli로 접근할 때가 있으므로 cli를 설치한다.

1. mongodb-database-tools 설치

   ```bash
   brew tap mongodb/brew
   brew install mongodb-database-tools
   ```

2. mongodump & mongorestore 설치 확인

   ```bash
   mongodump --version
   mongorestore --version
   ```

   mongodump와 mongorestore를 쓸 수 있게 된다.

### Slack

```bash
brew install --cask slack
```

### Notion

```bash
brew install --cask notion
```

# 토큰 및 키 설정

## Github

1. ssh key 생성

   ```bash
   $ ssh-keygen
   ```

   key의 이름을 입력한다. 그러면 명령을 실행한 폴더에 public & private 키가 생성된다. private key는 `~/.ssh` 폴더에 넣고 public 키는 복사해서 github에 등록한다.

2. github에 public key 등록

   1. 회사 github 계정에서 `settings` > `SSH and GPG keys` > `New SSH key` 로 복사한 public 키를 등록한다.

      ![Untitled](https://prod-files-secure.s3.us-west-2.amazonaws.com/44e82b1c-cfcb-4fc9-b21a-53a04dc00787/66430236-f949-4658-9b28-93fed0f260c7/Untitled.png)

3. Grant read permission to `~/.ssh`

   ```json
   chmod 400 ~/.ssh/butterflying
   ```

4. Add ssh key

   ```bash
   ssh-add ~/.ssh/butterflying
   ```

위 과정이 모두 끝나면 이제 ssh 방식으로 github repository를 clone할 수 있다.

### .gitconfig

`~/.gitconfig`  에서 git 명령어를 alias 할 수 있다.

```bash
...
[alias]
  a = add
  cm = commit
  br = branch
  co = checkout
```

## AWS

### AWS Console MFA 설정

> ***aws console에 로그인을 한 후 authy를 이용해서 MFA 설정을 반드시 한다.***

### AWS CLI 설치

```bash
brew install awscli
```

### Pem 키 등록

butterfyling.pem 키를 요청하여 `~/.ssh/butterflying.pem` 에 저장하자. ec2를 직접 ssh로 접속할 때 필요하다.

### AWS Key 등록

1. config 등록

   `~/.aws/config` 에 다음 과 값이 등록

   ```json
   [default]
   region=ap-northeast-2
   output=json
   
   [profile butterflying]
   region=ap-northeast-2
   output=json
   ```

2. credentials 등록

   `~/.aws/credentials` 에 다음과 같이 등록

   ```bash
   [default]
   aws_access_key_id = <access key>
   aws_secret_access_key = <secret key>
   
   [butterflying]
   aws_access_key_id = <access key>
   aws_secret_access_key = <secret key>
   ```

   키 값은 개발 팀장에게 요청한다.

3. aws cli로 aws 키 등록

   ```bash
   $ aws configure
   
   # prompt 내용대로 키 값과 설정 값을 입력해준다.
   # 위에 config와 credentials를 잘 입력하였다면 enter만 눌러도 된다.
   ```

   `aws sts get-caller-identity` 명령어로 자신의 계정이 로컬에 잘 등록되었는지 확인. arn 값을 잘 보고 aws console 비교하여 맞으면 success.

## Openvpn 설정

Private ec2에 접근하기 위해 bastion host 역할과 openvpn 역할을 하고 있는 openvpn server와 연결이 필요하다. mac에서는 tunnelblick 툴을 이용하고 openvpn의 키 값을 추가하면 손쉽게 vpn을 통해 private ec2에 접근할 수 있다.

1. 설치

   ```bash
   brew install tunnelblick
   ```

2. openvpn ec2 서버는 public에 있으니 pem 키만 있으면 ssh로 접속할 수 있다. ssh로 접속 후 `/opt/butterflying.ovpn` 파일을 복사해서 자신의 로컬 호스트 pc에 저장한다. 그리고 실행하면 tunnelblick에 등록되고 로컬 pc에서 private subnet에 있는 resource에 접근할 수 있게 된다. 물론 접속할 때 pem키도 당연히 필요하다.

3. ssh config 값은 팀원에게 요청해서 공유 받는다.

# 인프라 필수 프로그램

## Terraform

### 설치

```
brew tap hashicorp/tap
brew install hashicorp/tap/terraform
terraform version
```

### **Enable tab completion**

```
terraform -install-autocomplete
```

`~/.zshrc` 파일에 아래와 같이 적는다.

```bash
autoload -U +X bashcompinit && bashcompinit
complete -o nospace -C /opt/homebrew/bin/terraform terraform
complete -o nospace -C /opt/homebrew/bin/packer packer
```

추후 packer도 설치해야 하므로 지금 추가해준다.

```
source ~/.zshrc
```

zshrc 재실행.  이제 auto complete terraform command `terraform + tab` 가 가능하다.

### **Terraform cache**

**Ref**

- https://www.terraform.io/docs/cli/config/config-file.htmlhttps://www.terraform.io/docs/cli/config/config-file.html

Add `plugin_cache_dir = "$HOME/.terraform.d/plugin-cache"` to `~/.terraformrc`

Create directory

```
mkdir -p ~/.terraform.d/plugin-cache
```

plugin_cache_dir 설정을 통해 테라폼의 캐시 저장 공간을 중앙집중식으로 효율적으로 관리할 수 있다. That is, it is possible to centerally manage the terraform providers and modules each workspaces requires.

### 테라폼 클라우드 토큰 추가

```json
plugin_cache_dir = "$HOME/.terraform.d/plugin-cache"

credentials "app.terraform.io" {
  token = "<organization token>"
}
```

버터플라잉은 terraform cloud를 통해서 원격으로 테라폼 명령어를 실행하고 workspace를 관리하고 있다. 본인이 devops 권한이 있다면 Devops 관리자로부터 토큰을 받아서 설정한다.

### Mac M1 provider issue

M1 Mac은 darwin64 os를 사용한다. 그래서 간혹 terraform에서 지원하는 기능을 못 쓸 때가 있는데, 이를 해결해주는 방법을 알려주겠다.

1. `.terraform.lock.hcl`파일과 `.terraform` 폴더 삭제

2. 아래 명령어 실행
   ```sh
   brew install kreuzwerker/taps/m1-terraform-provider-helper
   terraform providers lock -platform=darwin_amd64
   m1-terraform-provider-helper activate
   m1-terraform-provider-helper install hashicorp/template -v v2.2.0
   ```

## Packer

### 설치

```
brew tap hashicorp/tap
brew install hashicorp/tap/packer
packer version
```

### **Enable tab completion**

```
packer -autocomplete-install
```

`~/.zshrc` 파일에 아래와 같이 적는다.

```
...
complete -o nospace -C /opt/homebrew/bin/packer packer
source ~/.zshrc
```

zshrc 재실행.  이제 auto complete packer command `packer + tab` 가 가능하다.

## Ansible

### 설치

```
brew install ansible
which ansible # /opt/homebrew/bin/ansible
```

### Packer with ansible

Ansible을 이용해서 packer로 이미지를 만들 때 “ansible-local”이나 “ansible” block이 안될 수가 있다.

```bash
packer plugins install github.com/hashicorp/ansible
```

위 플러그인을 설치해주자.